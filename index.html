<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Registro de Pagos - Evento</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
    .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-height: 90vh;
    }
    .header {
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        color: white;
        padding: 30px 20px;
        text-align: center;
        flex-shrink: 0;
    }
    .header h1 {
        margin: 0;
        font-size: 2.5em;
        font-weight: 300;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        user-select: none;
    }
    .header p {
        margin: 10px 0 0 0;
        opacity: 0.9;
        font-size: 1.1em;
        user-select: none;
    }
    .tabs {
        display: flex;
        background: #f8f9fa;
        border-bottom: 3px solid #e9ecef;
        flex-wrap: wrap;
        user-select: none;
    }
    .tab {
        flex: 1;
        padding: 18px 12px;
        text-align: center;
        cursor: pointer;
        background: #f8f9fa;
        border: none;
        font-size: 1.1em;
        font-weight: 600;
        color: #495057;
        transition: all 0.3s ease;
        position: relative;
        min-width: 100px;
        user-select: none;
    }
    .tab:hover,
    .tab:focus {
        background: #e9ecef;
        transform: translateY(-2px);
        outline: none;
    }
    .tab.active {
        background: white;
        color: #2c3e50;
        cursor: default;
        transform: none;
    }
    .tab.active::after {
        content: '';
        position: absolute;
        bottom: -3px;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .tab-content {
        display: none;
        padding: 20px;
        overflow-x: auto;
        flex-grow: 1;
        background: #fff;
    }
    .tab-content.active {
        display: block;
    }
    .table-container {
        background: white;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        overflow-x: auto;
        margin-bottom: 20px;
    }
    .table-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        text-align: center;
        border-radius: 10px 10px 0 0;
        font-weight: 600;
        font-size: 1.4em;
        user-select: none;
    }
    .summary-card {
        background: linear-gradient(135deg, #43cea2 0%, #185a9d 100%);
        color: white;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
        user-select: none;
    }
    .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }
    .summary-item {
        background: rgba(255,255,255,0.2);
        padding: 15px;
        border-radius: 8px;
        backdrop-filter: blur(10px);
    }
    .summary-item h3 {
        margin: 0 0 5px 0;
        font-size: 1.8em;
        font-weight: bold;
    }
    .summary-item p {
        margin: 0;
        opacity: 0.9;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        min-width: 720px;
        table-layout: fixed;
    }
    th {
        background: #f8f9fa;
        padding: 14px 10px;
        text-align: left;
        font-weight: 600;
        color: #2c3e50;
        border-bottom: 2px solid #e9ecef;
        position: sticky;
        top: 0;
        z-index: 2;
        user-select: none;
    }
    td {
        padding: 10px 8px;
        border-bottom: 1px solid #e9ecef;
        vertical-align: middle;
    }
    tr:hover {
        background: #f8f9fa;
    }
    input, select {
        width: 100%;
        padding: 6px 8px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
        box-sizing: border-box;
        transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    input:focus, select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 6px 2px rgba(102, 126, 234, 0.4);
        background: #f0f4ff;
    }
    select.status-pagado {
        background: #d4edda;
        border-color: #c3e6cb;
        color: #155724;
    }
    select.status-pendiente {
        background: #fff3cd;
        border-color: #ffeaa7;
        color: #856404;
    }
    select.status-cancelado {
        background: #f8d7da;
        border-color: #f5c6cb;
        color: #721c24;
    }
    .add-row-btn {
        background: #28a745;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        font-size: 1em;
        transition: background 0.3s ease;
        margin: 10px 0 20px 0;
        user-select: none;
    }
    .add-row-btn:hover,
    .add-row-btn:focus {
        background: #218838;
        outline: none;
    }
    .download-btn {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px 22px;
        border-radius: 50px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 5px 15px rgba(0,0,0,0.25);
        transition: all 0.3s ease;
        z-index: 999;
        user-select: none;
    }
    .download-btn:hover,
    .download-btn:focus {
        transform: translateY(-3px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.35);
        outline: none;
    }
    .download-btn.secondary {
        bottom: 90px;
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    }
    /* Responsive para m√≥viles */
    @media (max-width: 768px) {
        body {
            padding: 15px 10px;
        }
        .container {
            border-radius: 10px;
            box-shadow: 0 12px 30px rgba(0,0,0,0.1);
        }
        .header h1 {
            font-size: 1.8em;
        }
        .header p {
            font-size: 1em;
        }
        .tabs {
            flex-direction: column;
            border-bottom: none;
        }
        .tab {
            flex: none;
            padding: 12px 10px;
            border-bottom: 1px solid #e9ecef;
            font-size: 1em;
        }
        .tab.active::after {
            display: none;
        }
        .tab-content {
            padding: 15px 5px;
        }
        table {
            min-width: 100%;
        }
        th, td {
            padding: 8px 5px;
            font-size: 13px;
        }
        .summary-grid {
            grid-template-columns: 1fr;
        }
        .add-row-btn {
            width: 100%;
            font-size: 1.1em;
            padding: 14px 0;
        }
        .download-btn {
            bottom: 20px;
            right: 20px;
            padding: 12px 18px;
            font-size: 0.9em;
        }
        .download-btn.secondary {
            bottom: 75px;
            right: 20px;
            padding: 12px 18px;
        }
    }
</style>
</head>
<body>
<div class="container" role="main">
    <header class="header">
        <h1>üéâ Registro de Pagos del Evento</h1>
        <p>Sistema de control de pagos para chivas y remate</p>
    </header>

    <nav class="tabs" role="tablist" aria-label="Pesta√±as de control de pagos">
        <button class="tab active" data-tab="chiva1" role="tab" aria-selected="true" tabindex="0" aria-controls="chiva1">üöå Chiva 1</button>
        <button class="tab" data-tab="chiva2" role="tab" aria-selected="false" tabindex="-1" aria-controls="chiva2">üöå Chiva 2</button>
        <button class="tab" data-tab="chiva3" role="tab" aria-selected="false" tabindex="-1" aria-controls="chiva3">üöå Chiva 3</button>
        <button class="tab" data-tab="remate" role="tab" aria-selected="false" tabindex="-1" aria-controls="remate">üèÜ Remate</button>
    </nav>

    <section id="chiva1" class="tab-content active" role="tabpanel" tabindex="0" aria-labelledby="chiva1-tab">
        <div class="summary-card" aria-live="polite" aria-atomic="true" aria-relevant="all">
            <div class="table-header">üìä Resumen Chiva 1</div>
            <div class="summary-grid">
                <div class="summary-item"><h3 id="total-chiva1">0</h3><p>Total Personas</p></div>
                <div class="summary-item"><h3 id="pagados-chiva1">0</h3><p>Pagados</p></div>
                <div class="summary-item"><h3 id="pendientes-chiva1">0</h3><p>Pendientes</p></div>
                <div class="summary-item"><h3 id="ingresos-chiva1">$0</h3><p>Ingresos</p></div>
            </div>
        </div>
        <div class="table-container" role="region" aria-label="Tabla de pagos Chiva 1">
            <table id="table-chiva1" aria-describedby="desc-chiva1" tabindex="0">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Nombre Completo</th>
                        <th scope="col">Tel√©fono</th>
                        <th scope="col">Email</th>
                        <th scope="col">Valor</th>
                        <th scope="col">Estado</th>
                        <th scope="col">Fecha Pago</th>
                        <th scope="col">Observaciones</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <button class="add-row-btn" type="button" aria-label="Agregar persona a Chiva 1" onclick="addRow('chiva1')">‚ûï Agregar Persona</button>
        </div>
    </section>

    <section id="chiva2" class="tab-content" role="tabpanel" tabindex="0" aria-labelledby="chiva2-tab">
        <div class="summary-card" aria-live="polite" aria-atomic="true" aria-relevant="all">
            <div class="table-header">üìä Resumen Chiva 2</div>
            <div class="summary-grid">
                <div class="summary-item"><h3 id="total-chiva2">0</h3><p>Total Personas</p></div>
                <div class="summary-item"><h3 id="pagados-chiva2">0</h3><p>Pagados</p></div>
                <div class="summary-item"><h3 id="pendientes-chiva2">0</h3><p>Pendientes</p></div>
                <div class="summary-item"><h3 id="ingresos-chiva2">$0</h3><p>Ingresos</p></div>
            </div>
        </div>
        <div class="table-container" role="region" aria-label="Tabla de pagos Chiva 2">
            <table id="table-chiva2" aria-describedby="desc-chiva2" tabindex="0">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Nombre Completo</th>
                        <th scope="col">Tel√©fono</th>
                        <th scope="col">Email</th>
                        <th scope="col">Valor</th>
                        <th scope="col">Estado</th>
                        <th scope="col">Fecha Pago</th>
                        <th scope="col">Observaciones</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <button class="add-row-btn" type="button" aria-label="Agregar persona a Chiva 2" onclick="addRow('chiva2')">‚ûï Agregar Persona</button>
        </div>
    </section>

    <section id="chiva3" class="tab-content" role="tabpanel" tabindex="0" aria-labelledby="chiva3-tab">
        <div class="summary-card" aria-live="polite" aria-atomic="true" aria-relevant="all">
            <div class="table-header">üìä Resumen Chiva 3</div>
            <div class="summary-grid">
                <div class="summary-item"><h3 id="total-chiva3">0</h3><p>Total Personas</p></div>
                <div class="summary-item"><h3 id="pagados-chiva3">0</h3><p>Pagados</p></div>
                <div class="summary-item"><h3 id="pendientes-chiva3">0</h3><p>Pendientes</p></div>
                <div class="summary-item"><h3 id="ingresos-chiva3">$0</h3><p>Ingresos</p></div>
            </div>
        </div>
        <div class="table-container" role="region" aria-label="Tabla de pagos Chiva 3">
            <table id="table-chiva3" aria-describedby="desc-chiva3" tabindex="0">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Nombre Completo</th>
                        <th scope="col">Tel√©fono</th>
                        <th scope="col">Email</th>
                        <th scope="col">Valor</th>
                        <th scope="col">Estado</th>
                        <th scope="col">Fecha Pago</th>
                        <th scope="col">Observaciones</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <button class="add-row-btn" type="button" aria-label="Agregar persona a Chiva 3" onclick="addRow('chiva3')">‚ûï Agregar Persona</button>
        </div>
    </section>

    <section id="remate" class="tab-content" role="tabpanel" tabindex="0" aria-labelledby="remate-tab">
        <div class="summary-card" aria-live="polite" aria-atomic="true" aria-relevant="all">
            <div class="table-header">üìä Resumen Remate</div>
            <div class="summary-grid">
                <div class="summary-item"><h3 id="total-remate">0</h3><p>Total Personas</p></div>
                <div class="summary-item"><h3 id="pagados-remate">0</h3><p>Pagados</p></div>
                <div class="summary-item"><h3 id="pendientes-remate">0</h3><p>Pendientes</p></div>
                <div class="summary-item"><h3 id="ingresos-remate">$0</h3><p>Ingresos</p></div>
            </div>
        </div>
        <div class="table-container" role="region" aria-label="Tabla de pagos Remate">
            <table id="table-remate" aria-describedby="desc-remate" tabindex="0">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Nombre Completo</th>
                        <th scope="col">Tel√©fono</th>
                        <th scope="col">Email</th>
                        <th scope="col">Valor</th>
                        <th scope="col">Estado</th>
                        <th scope="col">Fecha Pago</th>
                        <th scope="col">Observaciones</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
            <button class="add-row-btn" type="button" aria-label="Agregar persona a Remate" onclick="addRow('remate')">‚ûï Agregar Persona</button>
        </div>
    </section>

    <button id="saveBtn" class="download-btn" aria-label="Guardar datos en la nube">üíæ Guardar</button>
    <button id="exportBtn" class="download-btn secondary" aria-label="Exportar datos a Excel">üì• Exportar Excel</button>
</div>

<script>
    // Cambia aqu√≠ por la URL del deploy de tu Google Apps Script Web App (modo POST)
    const API_URL = "https://script.google.com/macros/s/AKfycbwXjSztCoTQXYVpfpYoac9bFdV03CvyT2X8vNHdeTOnG562awgjucHOUxW0sjVSujbBFw/exec";

    // Para guardar y cargar datos localmente durante la sesi√≥n si quieres (opcional)
    // const LOCAL_STORAGE_KEY = "pagosEventoData";

    // Estado de los datos (objeto con arrays para cada pesta√±a)
    let data = {
        chiva1: [],
        chiva2: [],
        chiva3: [],
        remate: []
    };

    // Tab switching
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            if (tab.classList.contains('active')) return;
            // Cambiar activo
            tabs.forEach(t => {
                t.classList.remove('active');
                t.setAttribute('aria-selected', 'false');
                t.setAttribute('tabindex', '-1');
            });
            tab.classList.add('active');
            tab.setAttribute('aria-selected', 'true');
            tab.setAttribute('tabindex', '0');
            // Mostrar contenido correspondiente
            const target = tab.dataset.tab;
            tabContents.forEach(tc => {
                if(tc.id === target){
                    tc.classList.add('active');
                    tc.setAttribute('tabindex', '0');
                } else {
                    tc.classList.remove('active');
                    tc.setAttribute('tabindex', '-1');
                }
            });
        });
    });

    // Agregar fila a tabla
    function addRow(tab) {
        const tableBody = document.querySelector(`#table-${tab} tbody`);
        const index = tableBody.children.length + 1;
        const row = document.createElement('tr');

        // Nombre completo
        const nameTd = document.createElement('td');
        const nameInput = document.createElement('input');
        nameInput.type = 'text';
        nameInput.placeholder = 'Nombre completo';
        nameInput.setAttribute('aria-label', 'Nombre completo');
        nameTd.appendChild(nameInput);

        // Tel√©fono
        const phoneTd = document.createElement('td');
        const phoneInput = document.createElement('input');
        phoneInput.type = 'tel';
        phoneInput.placeholder = 'Tel√©fono';
        phoneInput.setAttribute('aria-label', 'Tel√©fono');
        phoneTd.appendChild(phoneInput);

        // Email
        const emailTd = document.createElement('td');
        const emailInput = document.createElement('input');
        emailInput.type = 'email';
        emailInput.placeholder = 'Correo electr√≥nico';
        emailInput.setAttribute('aria-label', 'Correo electr√≥nico');
        emailTd.appendChild(emailInput);

        // Valor
        const valorTd = document.createElement('td');
        const valorInput = document.createElement('input');
        valorInput.type = 'number';
        valorInput.min = '0';
        valorInput.placeholder = 'Valor';
        valorInput.setAttribute('aria-label', 'Valor pagado');
        valorTd.appendChild(valorInput);

        // Estado (select)
        const estadoTd = document.createElement('td');
        const estadoSelect = document.createElement('select');
        estadoSelect.setAttribute('aria-label', 'Estado del pago');
        estadoSelect.classList.add('status-pendiente');
        ['Pendiente', 'Pagado', 'Cancelado'].forEach(status => {
            const option = document.createElement('option');
            option.value = status;
            option.textContent = status;
            estadoSelect.appendChild(option);
        });
        estadoSelect.value = 'Pendiente';
        estadoSelect.addEventListener('change', () => {
            updateEstadoStyle(estadoSelect);
        });
        estadoTd.appendChild(estadoSelect);

        // Fecha Pago
        const fechaTd = document.createElement('td');
        const fechaInput = document.createElement('input');
        fechaInput.type = 'date';
        fechaInput.setAttribute('aria-label', 'Fecha de pago');
        fechaTd.appendChild(fechaInput);

        // Observaciones
        const obsTd = document.createElement('td');
        const obsInput = document.createElement('input');
        obsInput.type = 'text';
        obsInput.placeholder = 'Observaciones';
        obsInput.setAttribute('aria-label', 'Observaciones');
        obsTd.appendChild(obsInput);

        // √çndice (n√∫mero)
        const indexTd = document.createElement('td');
        indexTd.textContent = index;

        // Orden correcto: n√∫mero, nombre, tel√©fono, email, valor, estado, fecha, observaciones
        row.appendChild(indexTd);
        row.appendChild(nameTd);
        row.appendChild(phoneTd);
        row.appendChild(emailTd);
        row.appendChild(valorTd);
        row.appendChild(estadoTd);
        row.appendChild(fechaTd);
        row.appendChild(obsTd);

        tableBody.appendChild(row);

        updateAllSummaries();
    }

    // Actualiza el color del select seg√∫n estado
    function updateEstadoStyle(select) {
        select.classList.remove('status-pendiente', 'status-pagado', 'status-cancelado');
        const val = select.value.toLowerCase();
        if(val === 'pendiente') select.classList.add('status-pendiente');
        else if(val === 'pagado') select.classList.add('status-pagado');
        else if(val === 'cancelado') select.classList.add('status-cancelado');
    }

    // Extrae datos de una tabla a array de objetos
    function extractTableData(tab) {
        const rows = document.querySelectorAll(`#table-${tab} tbody tr`);
        const arr = [];
        rows.forEach((tr, i) => {
            const cells = tr.querySelectorAll('td');
            // celdas: 0 index, 1 nombre, 2 tel√©fono, 3 email, 4 valor, 5 estado, 6 fecha, 7 observaciones
            arr.push({
                nombre: cells[1].querySelector('input').value.trim(),
                telefono: cells[2].querySelector('input').value.trim(),
                email: cells[3].querySelector('input').value.trim(),
                valor: parseFloat(cells[4].querySelector('input').value) || 0,
                estado: cells[5].querySelector('select').value,
                fecha: cells[6].querySelector('input').value,
                observaciones: cells[7].querySelector('input').value.trim()
            });
        });
        return arr;
    }

    // Carga datos a la tabla desde un array de objetos
    function loadTableData(tab, arr) {
        const tbody = document.querySelector(`#table-${tab} tbody`);
        tbody.innerHTML = '';
        arr.forEach((item, i) => {
            const row = document.createElement('tr');

            // √çndice
            const indexTd = document.createElement('td');
            indexTd.textContent = i + 1;

            // Nombre completo
            const nameTd = document.createElement('td');
            const nameInput = document.createElement('input');
            nameInput.type = 'text';
            nameInput.value = item.nombre || '';
            nameInput.setAttribute('aria-label', 'Nombre completo');
            nameTd.appendChild(nameInput);

            // Tel√©fono
            const phoneTd = document.createElement('td');
            const phoneInput = document.createElement('input');
            phoneInput.type = 'tel';
            phoneInput.value = item.telefono || '';
            phoneInput.setAttribute('aria-label', 'Tel√©fono');
            phoneTd.appendChild(phoneInput);

            // Email
            const emailTd = document.createElement('td');
            const emailInput = document.createElement('input');
            emailInput.type = 'email';
            emailInput.value = item.email || '';
            emailInput.setAttribute('aria-label', 'Correo electr√≥nico');
            emailTd.appendChild(emailInput);

            // Valor
            const valorTd = document.createElement('td');
            const valorInput = document.createElement('input');
            valorInput.type = 'number';
            valorInput.min = '0';
            valorInput.value = item.valor || 0;
            valorInput.setAttribute('aria-label', 'Valor pagado');
            valorTd.appendChild(valorInput);

            // Estado
            const estadoTd = document.createElement('td');
            const estadoSelect = document.createElement('select');
            estadoSelect.setAttribute('aria-label', 'Estado del pago');
            ['Pendiente', 'Pagado', 'Cancelado'].forEach(status => {
                const option = document.createElement('option');
                option.value = status;
                option.textContent = status;
                estadoSelect.appendChild(option);
            });
            estadoSelect.value = item.estado || 'Pendiente';
            updateEstadoStyle(estadoSelect);
            estadoSelect.addEventListener('change', () => {
                updateEstadoStyle(estadoSelect);
                updateAllSummaries();
            });
            estadoTd.appendChild(estadoSelect);

            // Fecha pago
            const fechaTd = document.createElement('td');
            const fechaInput = document.createElement('input');
            fechaInput.type = 'date';
            fechaInput.value = item.fecha || '';
            fechaInput.setAttribute('aria-label', 'Fecha de pago');
            fechaTd.appendChild(fechaInput);

            // Observaciones
            const obsTd = document.createElement('td');
            const obsInput = document.createElement('input');
            obsInput.type = 'text';
            obsInput.value = item.observaciones || '';
            obsInput.placeholder = 'Observaciones';
            obsInput.setAttribute('aria-label', 'Observaciones');
            obsTd.appendChild(obsInput);

            // A√±adir celdas al fila (en orden)
            row.appendChild(indexTd);
            row.appendChild(nameTd);
            row.appendChild(phoneTd);
            row.appendChild(emailTd);
            row.appendChild(valorTd);
            row.appendChild(estadoTd);
            row.appendChild(fechaTd);
            row.appendChild(obsTd);

            tbody.appendChild(row);
        });
    }

    // Actualizar los res√∫menes de todas las pesta√±as
    function updateAllSummaries() {
        ['chiva1', 'chiva2', 'chiva3', 'remate'].forEach(tab => {
            const arr = extractTableData(tab);
            data[tab] = arr; // Actualizar estado
            updateSummary(tab, arr);
        });
    }

    // Actualizar resumen individual
    function updateSummary(tab, arr) {
        const total = arr.length;
        const pagados = arr.filter(x => x.estado.toLowerCase() === 'pagado').length;
        const pendientes = arr.filter(x => x.estado.toLowerCase() === 'pendiente').length;
        const ingresos = arr.reduce((acc, cur) => {
            if(cur.estado.toLowerCase() === 'pagado') return acc + (cur.valor || 0);
            return acc;
        }, 0);

        document.getElementById(`total-${tab}`).textContent = total;
        document.getElementById(`pagados-${tab}`).textContent = pagados;
        document.getElementById(`pendientes-${tab}`).textContent = pendientes;
        document.getElementById(`ingresos-${tab}`).textContent = `$${ingresos.toLocaleString('es-CO')}`;
    }

    // Guardar datos en Google Sheets (Apps Script)
    async function saveData() {
        // Extraer datos actualizados para enviar
        updateAllSummaries();

        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                mode: 'cors',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            });
            if (!response.ok) {
                throw new Error(`Error HTTP: ${response.status}`);
            }
            const result = await response.json();
            if(result.status === 'success'){
                alert('‚úÖ Datos guardados correctamente en la nube.');
            } else {
                alert('‚ùå Error al guardar: ' + (result.message || ''));
            }
        } catch (error) {
            alert('‚ùå Error de conexi√≥n o servidor: ' + error.message);
        }
    }

    // Descargar datos a Excel
    function exportToExcel() {
        updateAllSummaries();

        let htmlTable = `<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
        <head><meta charset="UTF-8"></head><body>`;

        ['chiva1', 'chiva2', 'chiva3', 'remate'].forEach(tab => {
            htmlTable += `<h2>${tab.toUpperCase()}</h2>`;
            htmlTable += document.querySelector(`#table-${tab}`).outerHTML;
            htmlTable += `<br/>`;
        });

        htmlTable += "</body></html>";

        const blob = new Blob([htmlTable], {
            type: "application/vnd.ms-excel;charset=utf-8"
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `RegistroPagos_Evento_${new Date().toISOString().slice(0,10)}.xls`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    // Eventos
    document.getElementById('saveBtn').addEventListener('click', saveData);
    document.getElementById('exportBtn').addEventListener('click', exportToExcel);

    // Actualiza resumen cuando cambian inputs o selects
    function bindTableEvents(tab) {
        const tbody = document.querySelector(`#table-${tab} tbody`);
        tbody.addEventListener('input', () => updateAllSummaries());
        tbody.addEventListener('change', () => updateAllSummaries());
    }
    ['chiva1', 'chiva2', 'chiva3', 'remate'].forEach(tab => {
        bindTableEvents(tab);
    });

    // Inicializaci√≥n al cargar p√°gina: cargar datos (vac√≠o)
    function initialize() {
        ['chiva1', 'chiva2', 'chiva3', 'remate'].forEach(tab => {
            loadTableData(tab, []);
        });
        updateAllSummaries();
    }
    initialize();

</script>
</body>
</html>
